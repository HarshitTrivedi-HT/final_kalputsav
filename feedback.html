<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="icon" href="logomain.png" type="image/x-icon">
  <meta name="description" content='Kalputsav ‚Äì Ekayanaa School‚Äôs Annual Exhibition

  "Kalputsav" is the much-anticipated annual exhibition hosted by Ekayanaa School, designed to celebrate creativity, curiosity, and interdisciplinary learning. This vibrant event brings together students, teachers, and parents in a collective celebration of knowledge and innovation across all subjects.'>
  <meta name="keywords" content="Kalputsav, Ekayanaa, Exhibition, Annual">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Feedback Kalpotsav | Ekayanaa School</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="main" class="bg-primary border-bottom border-body" data-bs-theme="dark">
    <!-- <img src="download.png" id="mainek"alt=""> -->
   
      <center>  <h1> <img src="logomain.png" id="lgm" alt="" srcset=""> The Kalpotsav 2025-26 </h1><i>Festival of Imagination</i></center>
    
  </div>

  <nav class="navbar  navbar-expand-lg bg-primary border-bottom border-body" data-bs-theme="dark">

    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">Home</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button><br>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="areas.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="feedback.html">Give Your Feedback</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              More
            </a>
            <ul class="dropdown-menu">
              
              <li><a class="dropdown-item" href="#subs">Subjects</a></li>
             <li><a class="dropdown-item" href="psy.html">Physcology Exibhit</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }

        h1, h2 {
            color: #007bff;
        }

        /* Form Styling */
        #feedback-form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Ensures padding doesn't affect total width */
        }

        button[type="submit"] {
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        button[type="submit"]:hover {
            background-color: #218838;
        }

        /* Feedback Display Styling */
        #feedback-display h2 {
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }

        #feedbackList {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .feedback-card {
            background-color: #fff;
            border-left: 5px solid #007bff;
            padding: 20px;
            width: 300px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .feedback-card h3 {
            margin-top: 0;
            color: #333;
        }

        .rating {
            font-weight: bold;
            color: #ffc107; /* Star color */
        }

        .loading-message {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üåü Kalpotsav Annual Exhibition Feedback System</h1>

    <section id="feedback-form">
        <h2>Submit Your Feedback</h2>
        <form id="feedbackForm">
            <label for="name">Your Name:</label>
            <input type="text" id="name" required>

            <label for="rating">Rating (1-5):</label>
            <input type="number" id="rating" min="1" max="5" required>

            <label for="comment">Your Comment:</label>
            <textarea id="comment" rows="4" required></textarea>

            <button type="submit">Submit Feedback</button>
        </form>
    </section>

    <hr>

    <section id="feedback-display">
        <h2>Community Feedback (Visible to All)</h2>
        <div id="feedbackList">
            <p class="loading-message">Loading feedback...</p>
        </div>
        <p style="font-size: 0.9em; margin-top: 20px;">
            ‚úÖ **Cross-Device Feature:** Data is stored in Google Sheets via a secure API, ensuring all visitors see the same feedback.
        </p>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('feedbackForm');
            const feedbackListContainer = document.getElementById('feedbackList');

            // !!! IMPORTANT: REPLACE THIS PLACEHOLDER WITH YOUR DEPLOYED WEB APP URL !!!
            const API_URL = 'https://script.google.com/macros/s/AKfycbyGa7SLoLGLsznvxx6fFunNy7sgt5rkig3MHiRMArkGY2WtbTkZJnIQ65Bt3AmpyeWg/exec'; 

            // Helper to render a single feedback card
            function createFeedbackCard(feedback) {
                const card = document.createElement('div');
                card.className = 'feedback-card';
                // Use the numeric rating to generate stars
                const ratingStars = '‚≠ê'.repeat(feedback.rating); 

                card.innerHTML = `
                    <h3>${feedback.name}</h3>
                    <p>Rating: <span class="rating">${feedback.rating} / 5</span> ${ratingStars}</p>
                    <p>Comment: ${feedback.comment}</p>
                    <p style="font-size: 0.8em; color: #666;">Submitted: ${feedback.timestamp}</p>
                `;
                return card;
            }

            // --- FUNCTION 1: Load and Display Feedback (GET request) ---
            async function displayFeedback() {
                feedbackListContainer.innerHTML = '<p class="loading-message">Fetching the latest feedback from the server...</p>';
                try {
                    const response = await fetch(API_URL);
                    
                    if (!response.ok) {
                        // Throw an error if the server response is not successful
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const feedbackArray = await response.json(); 

                    feedbackListContainer.innerHTML = ''; 
                    
                    // Reverse the array to show the newest feedback first
                    if (feedbackArray.length > 0) {
                        // Skip the header row if the script is fetching it (header is always the first item in the sheet)
                        const dataOnly = feedbackArray.filter(item => item.name !== 'name'); 
                        dataOnly.reverse().forEach(feedback => {
                            feedbackListContainer.appendChild(createFeedbackCard(feedback));
                        });
                    } else {
                        feedbackListContainer.innerHTML = '<p class="loading-message">No feedback submitted yet. Be the first!</p>';
                    }

                } catch (error) {
                    feedbackListContainer.innerHTML = '<p class="loading-message" style="color:red;">Error loading feedback. Please check the API URL and network connection.</p>';
                    console.error('Fetch error:', error);
                }
            }

            // --- FUNCTION 2: Handle Form Submission (POST request) ---
            form.addEventListener('submit', async (event) => {
                event.preventDefault(); 
                
                // Disable button and change text for feedback
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                const originalText = submitButton.textContent;
                submitButton.textContent = 'Submitting...';


                const name = document.getElementById('name').value.trim();
                const rating = parseInt(document.getElementById('rating').value, 10);
                const comment = document.getElementById('comment').value.trim();

                const newFeedback = { name, rating, comment };

                try {
                    // Send data to the Google Apps Script POST endpoint
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        // We use 'no-cors' mode because Google Apps Script is a cross-origin server
                        mode: 'no-cors', 
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(newFeedback) 
                    });

                    // Re-enable button
                    submitButton.disabled = false;
                    submitButton.textContent = originalText;
                    
                    // Clear the form and refresh the feedback list after a short delay
                    form.reset(); 
                    alert('Thank you! Your feedback has been submitted successfully.');
                    
                    // Give the sheet a moment (1.5 seconds) to process the write operation before refreshing
                    setTimeout(displayFeedback, 1500); 

                } catch (error) {
                    submitButton.disabled = false;
                    submitButton.textContent = originalText;
                    alert('An error occurred during submission. Please try again.');
                    console.error('Submission error:', error);
                }
            });

            // Initial call: Load all feedback when the page first loads
            displayFeedback();
        });
    </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
    crossorigin="anonymous"></script>
  <script src="script.js"></script>
</body>
  <center>
<footer><h6>Credits:- </h6><i>Developed by - Harshit Trivedi  X C</i></footer></center>
<hr>
</html>
